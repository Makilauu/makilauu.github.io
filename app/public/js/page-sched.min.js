// @import components/eventsManager
// @import components/Request
// @import components/result
// @import components/sched
// @import components/Spinner
// @import components/scroll
// @import components/Swipe
// @import components/standalone
// @import components/links
// @import components/RegParser
// @import components/cookies
// @import components/local
var pageSched={spinner:new Spinner,swipe:new Swipe,days:document.getElementsByClassName("days")[0],breakpoint:1060,mobile:!1,message:{element:document.createElement("span"),all:["Remerciez Satellys pour la latence...","Non, les cours ne sont pas annulés...","Ne partez pas ça devrait arriver...","Profitez-en pour vous servir un café...","C'est l'histoire de Jano Lapin...","L'temps passe, j'vois l'soleil s'lever, s'coucher...","Currently trying to make the world a better place...","Attention derrière toi...","L'accès Satellys j'l'ai pas loué..."],get random(){return this.all[Math.floor(Math.random()*this.all.length)]},set:function(){this.element.innerHTML="",this.element.appendChild(document.createTextNode(this.random))},init:function(){pageSched.spinner.element.appendChild(this.element)}},set loading(e){document.body.className=e?"loading":"",this.message.set(),e?this.spinner.show():this.spinner.hide()},get filters(){var e=this.form.groupFilters[this.form.group];if(void 0!==e&&null!==e)for(var t=this.form.filters,i=[],n=0;n<t.length;n++){var r=t[n];if(""!=r.value){var s=this.form.filtersData[e][r.name];i.push({test:s.test,contain:this.matcher(s.match),dontContain:this.matcher(s.dontMatch,!0),value:RegParser.compile(s.list[r.value])})}}return i},matcher:function(e,t){if("string"!=typeof e)return function(){return!0};var e=RegParser.compile(e);return t===!0?function(t){return null===t.match(e)}:function(t){return null!==t.match(e)}},update:function(e){this.form.update(),this.get(this.form.year,this.form.week,this.form.group,e)},clear:function(){this.days.innerHTML=""},form:{filtersData:api.filters,currentGroupFilters:null,groupFilters:api.groupFilters,element:document.getElementsByTagName("form")[0],filtersField:document.getElementsByTagName("form")[0].getElementsByClassName("filters")[0],inputs:{filters:document.getElementsByTagName("form")[0].getElementsByClassName("filters")[0].getElementsByTagName("select")},get group(){return this.inputs.group.value},get year(){return this.inputs.year.value},get week(){return this.inputs.week.value},get filters(){return Array.prototype.slice.call(this.inputs.filters).map(function(e){return{name:e.name,value:e.value}})},idForFilter:function(e){return"filter-"+e},update:function(){var e=this.groupFilters[this.group];if(e!=this.currentGroupFilters)if(this.currentGroupFilters=e,this.filtersField.innerHTML="",null!==e&&void 0!==e){var t=this.filtersData[e];if(void 0!==t){this.filtersField.removeAttribute("data-empty");for(var i in t){var n=t[i],r=document.createElement("div"),s=document.createElement("label"),a=document.createElement("select"),l=this.idForFilter(i);r.className="filter",s.appendChild(document.createTextNode(i)),s.setAttribute("for",l),a.name=i,a.id=l,a.on("change",this.onchange);var o=document.createElement("option");o.value="",o.appendChild(document.createTextNode("Aucun")),a.appendChild(o);for(var u in n.list){var o=document.createElement("option");o.value=u,o.appendChild(document.createTextNode(u)),a.appendChild(o)}r.appendChild(s),r.appendChild(a),this.filtersField.appendChild(r)}}}else{this.filtersField.setAttribute("data-empty",!0);var c=document.createElement("p");c.appendChild(document.createTextNode("Aucun filtre disponible")),this.filtersField.appendChild(c)}else this.saveFilters()},onchange:function(){pageSched.update()},saveFilters:function(){var e=this.groupFilters[this.group];if(null!==e&&void 0!==e){var t=this.filtersData[e];if(void 0!==t){var i={};for(var n in t)i[n]=document.getElementById(this.idForFilter(n)).value;cookies.set("filters",JSON.stringify(i))}}},loadFilters:function(){try{var e=JSON.parse(cookies.get("filters"))}catch(t){}if("object"==typeof e&&null!==e)for(var i in e)for(var n=document.getElementById(this.idForFilter(i)),r=n.getElementsByTagName("option"),s=!1,a=0;a<r.length&&!s;a++){var l=r[a];l.getAttribute("value")==e[i]&&(l.setAttribute("selected",!0),s=!0)}},init:function(){for(var e=this.element.getElementsByTagName("select"),t=0;t<e.length;t++){var i=e[t];"filter"!=i.parentNode.className&&(this.inputs[i.id.substr(6)]=i),i.on("change",this.onchange)}this.update(),this.loadFilters()}},get:function(e,t,i,n){var r=this;this.loading=!0,"function"!=typeof n&&(n=function(){}),sched.get(e,t,i,this.filters,function(e,t,i){e?(r.clear(),sched.constructor.insert(t.days),r.onresize(),r.form.week==api.defaultWeek&&r.mobile&&(r.swipe.page=api.defaultDay-1),n()):(result.set(t.message),i||r.clear()),r.loading=!1})},onresize:function(){window.innerWidth>this.breakpoint&&this.mobile?(this.swipe.page=0,this.swipe.disabled=!0,this.mobile=!1):window.innerWidth<this.breakpoint&&!this.mobile&&(this.mobile=!0,this.swipe.disabled=!1)},init:function(){var e=this;on("resize",function(){e.onresize()}),this.swipe.element=this.days,this.swipe.init(),this.message.init(),this.form.init(),this.update()}};pageSched.init();